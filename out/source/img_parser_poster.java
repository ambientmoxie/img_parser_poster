/* autogenerated by Processing revision 1276 on 2022-07-05 */
import processing.core.*;
import processing.data.*;
import processing.event.*;
import processing.opengl.*;

import java.util.HashMap;
import java.util.ArrayList;
import java.io.File;
import java.io.BufferedReader;
import java.io.PrintWriter;
import java.io.InputStream;
import java.io.OutputStream;
import java.io.IOException;

public class img_parser_poster extends PApplet {

PGraphics main;
PGraphics seed;
PGraphics shapes_dict;
PGraphics lerp;

PGraphics pic_01;
PGraphics pic_02;
PGraphics pic_03;
PGraphics pic_04;
PGraphics pic_05;
PGraphics pic_06;
PGraphics pic_07;

PImage seed_image;

// Dictionary variables //

IntDict inventory;
String storedColor;
int usableColor;
int starter;

int[] bright_numb;

int border;

float custom_width;
float custom_height;

 public void setup() {
    // size(700, 990); // A4 ratio
    /* size commented out by preprocessor */; // A4 ratio

    /* pixelDensity commented out by preprocessor */;
    border = 80;
    
    main = createGraphics(width - border, height - border);
    seed = createGraphics(main.width, main.height);
    shapes_dict = createGraphics(main.width, main.height);
    lerp = createGraphics(main.width, main.height);

    pic_01 = createGraphics(main.width / 8, main.height / 12);
    pic_02 = createGraphics(main.width / 8, main.height / 12);
    pic_03 = createGraphics(main.width / 8, main.height / 12);
    pic_04 = createGraphics(main.width / 8, main.height / 12);
    pic_05 = createGraphics(main.width / 8, main.height / 12);
    pic_06 = createGraphics(main.width / 8, main.height / 12);
    pic_07 = createGraphics(main.width / 8, main.height / 12);
    pic_07 = createGraphics(main.width / 8, main.height / 12);

    

    seed_image = loadImage("flower_2.jpg");

    // Dict variables

    inventory = new IntDict();
    starter = 1; 

}

 public void draw() {
    background(255);
    drawSeed();

    drawShapesDict();
    drawLerp();
    drawPic01();
    drawPic02();
    drawPic03();
    drawPic04();
    drawPic05();
    drawPic06();
    drawPic07();
    

    drawMain();

    pushMatrix();
    imageMode(CENTER);
    translate(width / 2, height / 2);
    image(main, 0, 0);
    popMatrix();

    //customCopy();

    // println(inventory.size());
}

 public void drawMain(){
    main.beginDraw();
    main.image(seed, 0, 0, (main.width / 4) * 3, (main.height / 6) * 4.5f);
    main.image(shapes_dict, 0, (main.height / 6) * 4, (main.width / 4) * 3, (main.height / 12) * 3);
    main.image(lerp, (main.width / 4) * 3, 0, main.width / 4 + 2, main.height);
    // main.image(pic_01, 0, 0);
    main.image(pic_02, 0, (main.height / 12) * 11, main.width / 8, main.height / 12 + 12);
    main.image(pic_05, main.width / 8, (main.height / 12) * 11, main.width / 8, main.height / 12 + 12);
    main.image(pic_03, (main.width / 8) * 2, (main.height / 12) * 11, main.width / 8, main.height / 12 + 12);
    main.image(pic_06, (main.width / 8) * 3, (main.height / 12) * 11, main.width / 8, main.height / 12 + 12);
    main.image(pic_04, (main.width / 8) * 4, (main.height / 12) * 11, main.width / 8, main.height / 12 + 12);
    main.image(pic_07, (main.width / 8) * 5, (main.height / 12) * 11, main.width / 8, main.height / 12 + 12);

    // main.noStroke();
    // main.fill(0,0,255);
    // main.rect((main.width / 150) * 167 ,0,main.width / 150, main.height);
    // main.fill(0,255,0);
    // main.rect((main.width / 150) * 166 ,0,main.width / 150, main.height);
    // main.fill(255,0,0);
    // main.rect((main.width / 150) * 165 ,0,main.width / 150, main.height);

    int lineBorder = 20;

    main.strokeWeight(lineBorder);
    main.stroke(0,0,255);
    main.line(main.width - lineBorder / 2, 0, main.width - lineBorder / 2, main.height);
    main.stroke(0,255,0);
    main.line(main.width - lineBorder * 1.5f, 0, main.width - lineBorder * 1.5f, main.height);
    main.stroke(255,0,0);
    main.line(main.width - lineBorder * 2.5f, 0, main.width - lineBorder * 2.5f, main.height);

    main.endDraw();
}

 public void drawSeed(){
    seed.beginDraw();
    seed.background(255,0,0);
    seed.image(seed_image, 0, 0, seed.width, seed.height);
    seed.endDraw();
}

 public void fillDict(){
    for (int i = 0; i < seed.width; ++i) {
        for (int j = 0; j < seed.height; ++j) {
            
            int pixelIndex = i + j * seed.width;
            int pixR = seed.pixels[pixelIndex];
            int pixG = seed.pixels[pixelIndex];
            int pixB = seed.pixels[pixelIndex];

            float cR = red(pixR);
            float cG = green(pixG);
            float cB = blue(pixB);

            storedColor = hex(color(cR, cG, cB));   

            if (inventory.hasKey(storedColor) == true) {
                inventory.increment(storedColor);
            } else {
                inventory.set(storedColor, starter);
            }
        }
    }

    inventory.sortValuesReverse();
}

 public void drawShapesDict(){
    shapes_dict.beginDraw();

    shapes_dict.clear();

    fillDict();

    float per_row = 6; // number of square per row
    float per_column = 3; // number of square per column
    float amount = per_row * per_column;
    float shapes_w = shapes_dict.width / per_row;
    float shapes_h = shapes_dict.height / per_column;

    float col = 0;
    float row = 0;
    int index = 0;

    shapes_dict.translate(-shapes_w, 0);

    while (index < amount) {

        // remap la totalité des data du dictionnaire sur l'index d'incrementation pour une plus grand variété de couleurs

        float inventory_mapping = map(index, 0, amount, 0, PApplet.parseFloat(inventory.size()));
        usableColor = unhex(inventory.key(PApplet.parseInt(inventory_mapping))); // old --> usableColor = unhex(inventory.key(index);

        col += shapes_w;
        index++;
        shapes_dict.stroke(usableColor);
        shapes_dict.fill(usableColor);
        shapes_dict.rect(col,row, shapes_w, shapes_h);

        if(index % per_row == 0) {
            row += shapes_h;
            col = 0;
        }
    }

    shapes_dict.endDraw();
}

 public void drawLerp() {
    lerp.beginDraw();

    fillDict();
    bright_numb = new int[inventory.size()];

    for(int i = 0; i < inventory.size(); i++) {
        usableColor = unhex(inventory.key(i));

        int uc_bright = PApplet.parseInt(brightness(usableColor));
        bright_numb[i] = uc_bright;
    }

    int dark_bright = min(bright_numb); // plus sombre
    int light_bright = max(bright_numb); // plus clair

    println(dark_bright, light_bright);

    float amount = 6;
    float shapes_w = lerp.width;
    float shapes_h = lerp.height / amount;

    float row = 0;
    int index = 0;

    lerp.translate(0, -shapes_h);

    while (index < amount) {

        row += shapes_h;

        float incr_bright = (light_bright - dark_bright) / (amount - 1);

        lerp.stroke(dark_bright + (incr_bright * index));
        lerp.fill(dark_bright + (incr_bright * index));

        println(incr_bright);
        
        lerp.rect(0,row, shapes_w, shapes_h);

        index++;
    }

    lerp.endDraw();
}

 public void drawPic01(){
    pic_01.beginDraw();
    pic_01.image(seed_image, 0, -pic_01.width / 6, pic_01.width / 2, (pic_01.height / 2) * 1.5f);
    pic_01.endDraw();
}

 public void drawPic02(){
    pic_02.beginDraw();
    
     for(int i = 0; i < pic_01.width; i++) {
        for(int j = 0; j < pic_01.height; j++) {
      
        int copyColor = pic_01.get(i, j);

        float px_r = red(copyColor);
        float px_g = green(copyColor);
        float px_b = blue(copyColor);

        int new_copy_color = color(px_r, 0, 0);
        
        pic_02.stroke(new_copy_color);
        pic_02.point(i, j);
      
    }
  }
    pic_02.endDraw();
}

 public void drawPic03(){
    pic_03.beginDraw();
    
     for(int i = 0; i < pic_01.width; i++) {
        for(int j = 0; j < pic_01.height; j++) {
      
        int copyColor = pic_01.get(i, j);

        float px_r = red(copyColor);
        float px_g = green(copyColor);
        float px_b = blue(copyColor);

        int new_copy_color = color(0, px_g, 0);
        
        pic_03.stroke(new_copy_color);
        pic_03.point(i, j);
      
    }
  }
    pic_03.endDraw();
}

 public void drawPic04(){
    pic_04.beginDraw();
    
     for(int i = 0; i < pic_01.width; i++) {
        for(int j = 0; j < pic_01.height; j++) {
      
        int copyColor = pic_01.get(i, j);

        float px_r = red(copyColor);
        float px_g = green(copyColor);
        float px_b = blue(copyColor);

        int new_copy_color = color(0, 0, px_b);
        
        pic_04.stroke(new_copy_color);
        pic_04.point(i, j);
    }
  }
    pic_04.endDraw();
}

 public void drawPic05(){
    
    pic_05.beginDraw();

    pic_05.colorMode(HSB, 360, 100, 100);
    
     for(int i = 0; i < pic_01.width; i++) {
        for(int j = 0; j < pic_01.height; j++) {
      
        int copyColor = pic_01.get(i, j);

        float px_h = hue(copyColor);
        float px_s = saturation(copyColor);
        float px_b = brightness(copyColor);

        int new_copy_color = color(px_h, px_s, px_b);
        
        pic_05.stroke(new_copy_color);
        pic_05.point(i, j);
      
    }
  }
    pic_05.endDraw();
}

 public void drawPic06(){
    
    pic_06.beginDraw();

    pic_06.colorMode(HSB, 360, 100, 100);
    
     for(int i = 0; i < pic_01.width; i++) {
        for(int j = 0; j < pic_01.height; j++) {
      
        int copyColor = pic_01.get(i, j);

        float px_h = hue(copyColor);
        float px_s = saturation(copyColor);
        float px_b = brightness(copyColor);

        int new_copy_color;

        if(px_b < 150) {
            new_copy_color = color(70, 100, 100);
        }else {
            new_copy_color = color(px_h, px_s, px_b);
        }
        

        
        pic_06.stroke(new_copy_color);
        pic_06.point(i, j);
      
    }
  }
    pic_06.endDraw();
}

 public void drawPic07(){
    
    pic_07.beginDraw();

    pic_07.colorMode(HSB, 360, 100, 100);
    
     for(int i = 0; i < pic_01.width; i++) {
        for(int j = 0; j < pic_01.height; j++) {
      
        int copyColor = pic_01.get(i, j);

        float px_h = hue(copyColor);
        float px_s = saturation(copyColor);
        float px_b = brightness(copyColor);

        int new_copy_color;

        if(px_s > 100) {
            new_copy_color = color(200, 0, 100);
        }else {
            new_copy_color = color(px_h, px_s, px_b);
        }
        
        pic_07.stroke(new_copy_color);
        pic_07.point(i, j);
      
    }
  }
    pic_07.endDraw();
}

 public void keyPressed() {
    if (key == 's' || key == 'S') {
      save("export/export.tif");
      exit();
    }
}


  public void settings() { size(2480, 3508);
pixelDensity(2); }

  static public void main(String[] passedArgs) {
    String[] appletArgs = new String[] { "img_parser_poster" };
    if (passedArgs != null) {
      PApplet.main(concat(appletArgs, passedArgs));
    } else {
      PApplet.main(appletArgs);
    }
  }
}
